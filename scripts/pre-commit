#!/usr/bin/env bash
# Pre-commit hook: auto-fix formatting, then run the same checks as CI.
# Install: ln -sf ../../scripts/pre-commit .git/hooks/pre-commit
set -euo pipefail

# Auto-fix formatting and stage the changes.
make fmt
git add -u

# Run all quality gates (lint, fmt-check, vet, test).
make check

# Web quality gates (typecheck + lint; skip tests for speed).
if command -v bun >/dev/null 2>&1; then
  (cd web && bun run tsc --noEmit && bun run biome check src/)
fi
